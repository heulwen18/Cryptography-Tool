<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECC Encryption</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/elliptic"></script>
    <script>
        let ec;

        document.addEventListener("DOMContentLoaded", () => {
            ec = new elliptic.ec("secp256k1");

            function generateECCKeys() {
                const keyPair = ec.genKeyPair();
                return {
                    publicKey: keyPair.getPublic("hex"),
                    privateKey: keyPair.getPrivate("hex"),
                };
            }

            function eccEncrypt(message, publicKey) {
                const key = ec.keyFromPublic(publicKey, "hex");
                return message.split("").map((char) =>
                    key.getPublic().mul(char.charCodeAt(0))
                );
            }

            function eccDecrypt(cipher, privateKey) {
                const key = ec.keyFromPrivate(privateKey, "hex");
                return cipher
                    .map((point) =>
                        String.fromCharCode(
                            key.derive(ec.curve.point(point.x, point.y)).toString(10)
                        )
                    )
                    .join("");
            }

            window.encrypt = function () {
                const plainText = document.getElementById("plainText").value.trim();

                if (!plainText) {
                    alert("Please enter plain text to encrypt.");
                    return;
                }

                try {
                    const keys = generateECCKeys();
                    const cipher = eccEncrypt(plainText, keys.publicKey);

                    document.getElementById("cipherText").value = JSON.stringify(
                        cipher.map((p) => ({ x: p.getX().toString(16), y: p.getY().toString(16) }))
                    );
                    document.getElementById("key").value = JSON.stringify(keys);
                } catch (error) {
                    console.error("Encryption failed:", error.message);
                    alert("Encryption failed. Please check your input.");
                }
            };

            window.decrypt = function () {
                const cipherText = document.getElementById("cipherText").value.trim();
                const keyInput = document.getElementById("key").value.trim();

                if (!cipherText || !keyInput) {
                    alert("Please enter both cipher text and key to decrypt.");
                    return;
                }

                try {
                    const cipher = JSON.parse(cipherText);
                    const keys = JSON.parse(keyInput);

                    if (!keys.privateKey) {
                        alert("Key must be a valid JSON object containing privateKey.");
                        return;
                    }

                    const plainText = eccDecrypt(
                        cipher.map((p) => ec.curve.point(p.x, p.y)),
                        keys.privateKey
                    );

                    document.getElementById("plainText").value = plainText;
                } catch (error) {
                    console.error("Decryption failed:", error.message);
                    alert("Decryption failed. Please check your input or key.");
                }
            };
        });
    </script>
</head>
<body>
    <h1>ECC Encryption</h1>
    <div>
        <h2>Encrypt</h2>
        <textarea id="plainText" placeholder="Enter plain text"></textarea>
        <button onclick="encrypt()">Encrypt</button>
    </div>
    <div>
        <h2>Decrypt</h2>
        <textarea id="cipherText" placeholder="Enter cipher text"></textarea>
        <textarea id="key" placeholder='Enter key (JSON format)'></textarea>
        <button onclick="decrypt()">Decrypt</button>
    </div>
    <a href="main.html" class="back-link">Back to Home</a>
</body>
</html>
